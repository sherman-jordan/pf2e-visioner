{{!--
  Simplified Observer Information - No complex Handlebars helpers
--}}
<div class="observer-info">
  <div class="observer-image">
    <img src="{{observer.img}}" data-tooltip="{{observer.name}}" />
  </div>
  <div class="observer-content">
    <div class="observer-main">
      <button type="button" class="mode-toggle {{#if isObserverMode}}observer-active{{else}}target-active{{/if}}" data-action="toggleMode" data-tooltip="Click to switch between Observer and Target modes" {{#if lootObserver}}disabled{{/if}}>
        {{#if (or lootObserver)}}
          <div class="toggle-option active">
            <i class="fas fa-user-secret"></i>
            <span>Target</span>
          </div>
        {{else}}
          <div class="toggle-option {{#if isObserverMode}}active{{/if}}">
            <i class="fas fa-eye"></i>
            <span>Observer</span>
          </div>
          <div class="toggle-divider">|</div>
          <div class="toggle-option {{#if isTargetMode}}active{{/if}}">
            <i class="fas fa-user-secret"></i>
            <span>Target</span>
          </div>
        {{/if}}
      </button>
      <h3 class="observer-name">{{observer.name}}</h3>
      {{#if isCoverTab}}
        {{#if isObserverMode}}
          <p class="hint">How much cover other tokens have against <em>{{observer.name}}</em></p>
        {{else}}
          <p class="hint">How much cover <em>{{observer.name}}</em> has against other tokens</p>
        {{/if}}
      {{else}}
        {{#if isObserverMode}}
          <p class="hint">How <em>{{observer.name}}</em> sees other placeables</p>
        {{else}}
          <p class="hint">How other placeables see <em>{{observer.name}}</em></p>
        {{/if}}
      {{/if}}
      
      {{!-- Encounter Filter + Ignore Allies --}}
      <div class="encounter-filter-section" style="display:flex; gap:16px; align-items:center;">
        {{#if showEncounterFilter}}
        <label class="encounter-filter-checkbox" style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" {{#if encounterOnly}}checked{{/if}} data-action="toggleEncounterFilter" data-tooltip="Only show tokens in the current encounter" />
          <span class="encounter-filter-label">{{localize "PF2E_VISIONER.UI.ENCOUNTER_FILTER_TEXT"}}</span>
        </label>
        {{/if}}
        <label class="ignore-allies-filter-checkbox" style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" {{#if ignoreAllies}}checked{{/if}} data-action="toggleIgnoreAllies" data-tooltip="Hide allies from the results list" />
          <span class="encounter-filter-label">Ignore allies</span>
        </label>
        <label class="hide-foundry-hidden-filter-checkbox" style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" {{#if hideFoundryHidden}}checked{{/if}} data-action="toggleHideFoundryHidden" data-tooltip="Visually hide tokens that are Foundry-hidden (document.hidden)" />
          <span class="encounter-filter-label">Hide Foundry-hidden tokens</span>
        </label>
        {{#if isObserverMode}}
          {{#if isVisibilityTab}}
            <label class="ignore-walls-filter-checkbox" style="display:flex; align-items:center; gap:8px;">
              <input type="checkbox" {{#if ignoreWalls}}checked{{/if}} data-action="toggleIgnoreWalls" data-tooltip="Hide walls from the results list" />
              <span class="encounter-filter-label">Ignore walls</span>
            </label>
          {{/if}}
        {{/if}}
      </div>
    </div>
  </div>

  <div class="observer-tools">
    <div class="icon-tab-navigation">
      <button type="button" class="icon-tab-button {{#if isVisibilityTab}}active{{/if}}" data-action="toggleTab" data-tab="visibility" data-tooltip="{{localize "PF2E_VISIONER.TOKEN_MANAGER.VISIBILITY_TAB"}}">
        <i class="fas fa-eye"></i>
      </button>
      {{#unless hideCoverTab}}
        <button type="button" class="icon-tab-button {{#if isCoverTab}}active{{/if}}" data-action="toggleTab" data-tab="cover" data-tooltip="{{localize "PF2E_VISIONER.TOKEN_MANAGER.COVER_TAB"}}">
          <i class="fas fa-shield-alt"></i>
        </button>
      {{/unless}}
    </div>

    <div class="legend-panel">
      {{#if isVisibilityTab}}
        <div class="visibility-legend">
          {{#each visibilityStates as |state|}}
            <div class="legend-item" data-tooltip="{{state.label}}">
              <i class="{{state.icon}} {{state.cssClass}}"></i>
              <span>{{state.label}}</span>
            </div>
          {{/each}}
        </div>
      {{else}}
        <div class="cover-legend">
          {{#each coverStates as |state|}}
            <div class="legend-item" data-tooltip="{{state.label}}{{#if state.bonusAC}} (+{{state.bonusAC}} AC{{#if state.bonusReflex}}, +{{state.bonusReflex}} Reflex{{/if}}{{#if state.bonusStealth}}, +{{state.bonusStealth}} Stealth{{/if}}){{/if}}">
              <i class="{{state.icon}} {{state.cssClass}}"></i>
              <span>{{state.label}}</span>
            </div>
          {{/each}}
        </div>
      {{/if}}
    </div>
  </div>
</div>
